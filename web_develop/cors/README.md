# 跨域问题

## 1.为什么有跨域问题

跨域不一定都会有跨域问题。

因为跨域问题是浏览器对于ajax请求的一种安全限制：**一个页面发起的ajax请求，只能是与当前页域名相同的路径**，这能有效的阻止跨站攻击。

因此：**跨域问题 是针对ajax的一种限制**。

生成环境多台服务器之间交互时，地址和端口都会不同



## 2.什么是同源策略

同源策略是一种约定:"协议+域名+端口"三者相同

即便两个不同的域名指向同一个ip地址，也非同源。



URL组成：

协议://域名:端口/请求路径?请求参数#锚点

http://www.example.com:80/path/to/myfile.html?key1=valu1&key2=value2#SomewhereTheDocument

| 协议 | 域名            | 端口 | 请求路径            | 请求参数               | 锚点                  |
| ---- | --------------- | ---- | ------------------- | ---------------------- | --------------------- |
| http | www.example.com | 80   | path/to/myfile.html | key1=valu1&key2=value2 | #SomewhereTheDocument |



同源策略限制以下几种行为：

- Cookie、LocalStorage 和 IndexDB 无法读取
- DOM和JS对象无法获得
- AJAX 请求不能发送

## 3.解决跨域问题的方案

目前比较常用的跨域解决方案有3种：

- Jsonp

  最早的解决方案，利用script标签可以跨域的原理实现。

  限制：

  - 需要服务的支持
  - 只能发起GET请求

- nginx反向代理

  思路是：利用nginx把跨域反向代理为不跨域，支持各种请求方式

  缺点：需要在nginx进行额外配置，语义不清晰 

- CORS

  规范化的跨域请求解决方案，安全可靠。

  优势：

  - 在服务端进行控制是否允许跨域，可自定义规则
  - 支持各种请求方式

  缺点：

  - 会产生额外的请求

